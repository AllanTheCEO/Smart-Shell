


    <!DOCTYPE HTML>
    <html lang="en">

    <head>

    <title>Linux Command Line Adventure: source</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="description" content="Bash Source Command Tutorial">
    <meta name="keywords" content="bash, shell scripting, source command, function libraries, configuration">
    <meta name="author" content="William Shotts, Jr.">
    <meta name="copyright" content="Copyright 2000-2025, William Shotts, Jr.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" type="text/css" href="linuxcommand5.css">
    <link rel="prev" href="lc3_adv_vimvigor.php.html">
    <link rel="next" href="lc3_adv_standards.php.html">
    <link rel="contents" href="lc3_adventures.php.html#contents">
    </head>

    <body>

    <div class="grid-container">
    <div class="colorblock-red">
    </div><!-- colorblock-red -->
    <div class="title-img">
    </div><!-- title-img -->
    <div class="colorblock-white">
    <div class="navbar">
      <ul style="line-height: 150%;">
        <li><a href="index.php.html">Home</a></li>
        <li><a href="lc3_learning_the_shell.php.html">Learning&nbsp;the&nbsp;Shell</a></li>
        <li><a href="lc3_writing_shell_scripts.php.html">Writing&nbsp;Shell&nbsp;Scripts</a></li>
        <li><a href="lc3_resources.php.html">Resources</a></li>
        <li><a href="tlcl.php.html">Books</a></li>
        <li><a href="lc3_adventures.php.html">Adventures</a></li>
      </ul>
      <hr>
      <ul>
        <li><a href="https://lcorg.blogspot.com">Blog</a></li>
      </ul>
    </div><!-- navbar -->
  
    </div><!-- colorblock-white -->

    <div id="top" class="main">
    <div class="pagenav">
      <div class="homebutton">
      <a
      href="index.php.html">Home</a> |
      </div>
      <a
      href="lc3_adv_vimvigor.php.html">Previous</a> | <a
      href="lc3_adventures.php.html#contents">Contents</a> | <a
      href="lc3_adv_standards.php.html">Next</a>
    </div>
<h1 id="source">source</h1>
<p>Most programming languages permit programmers to specify external files to be included within their programs. This is often used to add “boilerplate” code to programs for such things as defining standard constants and referencing external library function definitions.</p>
<p>Bash (along with <code>ksh</code> and <code>zsh</code>) has a builtin command, <code>source</code>, that implements this feature. We looked at <code>source</code> briefly when we worked with the <code>.profile</code> and <code>.bashrc</code> files used to establish the shell environment.</p>
<p>In this adventure, we will look at <code>source</code> again and discover the ways it can make our scripts more powerful and easier to maintain.</p>
<p>To recap, <code>source</code> reads a specified file and executes the commands within it using the current shell. It works both with the interactive command line and within a script. Using the command line for example, we can reload the <code>.bashrc</code> file by executing the following command:</p>
<p><code>me@linuxbox: ~$ source ~/.bashrc</code></p>
<p>Note that the <code>source</code> command can be abbreviated by a single dot character like so:</p>
<p><code>me@linuxbox: ~$ . ~/.bashrc</code></p>
<p>When <code>source</code> is used on the command line, the commands in the file are treated as if they are being typed directly at the keyboard. In a shell script, the commands are treated as though they are part of the script.</p>
<h2 id="configuration-files">Configuration Files</h2>
<p>During our exploration of the Linux ecosystem, we have seen that many programs rely on configuration files. Most of these are simple text files just like our bash shell scripts. By using <code>source</code>, we can easily create configuration files for our shell scripts as well.</p>
<p>Consider this example. Let’s imagine that we have several computers on our network that need to get backed up on a regular basis and that a central backup server is used to store the files from these various systems. On each of the backup client systems we have a script called <code>back_me_up</code> that copies the files over the network. Let’s further imagine that each client system needs to back up a different set directories.</p>
<p>To implement this, we might define a constant in the <code>back_me_up</code> script like this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="va">BACKUP_DIRS=</span><span class="st">&quot;/etc /usr/local /home&quot;</span></a></code></pre></div>
<p>However, doing it this way will require that we maintain a separate version of the script for each client. This will make maintaining the script much more laborious, as any future improvement to the script will have to be applied to each copy of the script individually. What’s more, this list of directories might be useful to other programs, too. For example, we could have a file restoration script called <code>restore_me</code> that restores files from the backup server to the backup client system. If this were the case, we would then have twice as many scripts to maintain. A much better way handle this issue would be to create a configuration file to define the <code>BACKUP_DIR</code> constant and source it into our scripts at run time.</p>
<p>Here’s how we could do it.</p>
<p>First, we will create a configuration file named <code>back_me_up.cfg</code> and place it somewhere sensible. Since the <code>back_me_up</code> and <code>restore_me</code> scripts are used on a system-wide basis (as would most backup programs), we will treat them like locally installed system resources. Thus, we would put them in the <code>/usr/local/sbin</code> directory and the configuration file in <code>/usr/local/etc</code>. The configuration file would contain the following:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1"><span class="co"># Configuration file for the back_me_up program</span></a>
<a class="sourceLine" id="cb2-2" title="2"></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="va">BACKUP_DIRS=</span><span class="st">&quot;/etc /usr/local /home&quot;</span></a></code></pre></div>
<p>While our configuration file must contain valid shell syntax, since its contents are executed by the shell, it differs from a real shell script in two regards. First, it does not require a shebang to indicate which shell executes it, and second, the file does not need executable permissions. It only needs to be readable by the shell.</p>
<p>Next, we would add the following code to the <code>back_me_up</code> and <code>restore_me</code> scripts to source our configuration file:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" title="1"><span class="va">CONFIG_FILE=</span>/usr/local/etc/back_me_up.cfg</a>
<a class="sourceLine" id="cb3-2" title="2"></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="kw">if [[</span> <span class="ot">-r</span> <span class="st">&quot;</span><span class="va">$CONFIG_FILE</span><span class="st">&quot;</span><span class="kw"> ]]</span>; <span class="kw">then</span></a>
<a class="sourceLine" id="cb3-4" title="4">    <span class="bu">source</span> <span class="st">&quot;</span><span class="va">$CONFIG_FILE</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="kw">else</span></a>
<a class="sourceLine" id="cb3-6" title="6">    <span class="bu">echo</span> <span class="st">&quot;Cannot read configuration file!&quot;</span> <span class="op">&gt;&amp;2</span></a>
<a class="sourceLine" id="cb3-7" title="7">    <span class="bu">exit</span> 1</a>
<a class="sourceLine" id="cb3-8" title="8"><span class="kw">fi</span></a></code></pre></div>
<h2 id="function-libraries">Function Libraries</h2>
<p>In addition to the configuration shared by both the <code>back_me_up</code> and <code>restore_me</code> scripts, there could be code shared between the two programs. For example, it makes sense to have a shared function to display error messages:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># ---------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="co"># Send message to std error</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co">#   Options:    none</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co">#   Arguments:  1 error_message</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co">#   Notes:      Use this function to report errors to standard error. Does</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co">#               not generate an error status.</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co"># ---------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="fu">error_msg()</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb4-9" title="9"></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="bu">printf</span> <span class="st">&quot;%s\n&quot;</span> <span class="st">&quot;</span><span class="va">$1</span><span class="st">&quot;</span> <span class="op">&gt;&amp;2</span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="kw">}</span></a></code></pre></div>
<p>How about a function that detects if the backup server is available on the network:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" title="1"><span class="co"># ---------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="co"># Detect if the specified host is available</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co">#   Options:    none </span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="co">#   Arguments:  1 hostname</span></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="co">#   Notes:      </span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="co"># ---------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="fu">ping_host()</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb5-8" title="8"></a>
<a class="sourceLine" id="cb5-9" title="9">  <span class="bu">local</span> <span class="va">MSG=</span><span class="st">&quot;Usage: </span><span class="va">${FUNCNAME[0]}</span><span class="st"> host&quot;</span></a>
<a class="sourceLine" id="cb5-10" title="10">  <span class="bu">local</span> <span class="va">MSG2=</span><span class="st">&quot;</span><span class="va">${FUNCNAME[0]}</span><span class="st">: host </span><span class="va">$1</span><span class="st"> unreachable&quot;</span></a>
<a class="sourceLine" id="cb5-11" title="11"></a>
<a class="sourceLine" id="cb5-12" title="12">  [[ <span class="va">$#</span> <span class="ex">-eq</span> 1 ]] <span class="kw">||</span> <span class="kw">{</span> <span class="ex">error_msg</span> <span class="st">&quot;</span><span class="va">$MSG</span><span class="st">&quot;</span> <span class="kw">;</span><span class="bu">return</span> 1<span class="kw">;</span> <span class="kw">}</span></a>
<a class="sourceLine" id="cb5-13" title="13">  <span class="fu">ping</span> -c1 <span class="st">&quot;</span><span class="va">$1</span><span class="st">&quot;</span> <span class="op">&amp;&gt;</span> /dev/null <span class="kw">||</span> <span class="kw">{</span> <span class="ex">error_msg</span> <span class="st">&quot;</span><span class="va">$MSG2</span><span class="st">&quot;</span><span class="kw">;</span> <span class="bu">return</span> 1<span class="kw">;</span> <span class="kw">}</span></a>
<a class="sourceLine" id="cb5-14" title="14">  <span class="bu">return</span> 0</a>
<a class="sourceLine" id="cb5-15" title="15"><span class="kw">}</span></a></code></pre></div>
<p>Another function both scripts could use checks that external programs we need for the scripts to run (like <code>rsync</code>) are actually installed:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" title="1"><span class="co"># ---------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="co"># Check if function/application is installed</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="co">#   Options:    none</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co">#   Arguments:  application...</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="co">#   Notes:      Exit status equals the number of missing functions/apps.</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="co"># ---------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="fu">app_avail()</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb6-8" title="8"></a>
<a class="sourceLine" id="cb6-9" title="9">  <span class="bu">local</span> <span class="va">MSG1=</span><span class="st">&quot;Usage: </span><span class="va">${FUNCNAME[0]}</span><span class="st"> app...&quot;</span></a>
<a class="sourceLine" id="cb6-10" title="10">  <span class="bu">local</span> <span class="va">MSG2</span></a>
<a class="sourceLine" id="cb6-11" title="11">  <span class="bu">local</span> <span class="va">exit_status=</span>0</a>
<a class="sourceLine" id="cb6-12" title="12"></a>
<a class="sourceLine" id="cb6-13" title="13">  [[ <span class="va">$#</span> <span class="ex">-gt</span> 0 ]] <span class="kw">||</span> <span class="kw">{</span> <span class="ex">error_msg</span> <span class="st">&quot;</span><span class="va">$MSG1</span><span class="st">&quot;</span><span class="kw">;</span> <span class="bu">return</span> 1<span class="kw">;</span> <span class="kw">}</span></a>
<a class="sourceLine" id="cb6-14" title="14">  <span class="kw">while [[</span> <span class="ot">-n</span> <span class="st">&quot;</span><span class="va">$1</span><span class="st">&quot;</span><span class="kw"> ]]</span>; <span class="kw">do</span></a>
<a class="sourceLine" id="cb6-15" title="15">    <span class="va">MSG2=</span><span class="st">&quot;Required program &#39;</span><span class="va">$1</span><span class="st">&#39; not available - please install&quot;</span></a>
<a class="sourceLine" id="cb6-16" title="16">    <span class="bu">type</span> -t <span class="st">&quot;</span><span class="va">$1</span><span class="st">&quot;</span> <span class="op">&gt;</span> /dev/null <span class="kw">||</span> <span class="kw">\</span></a>
<a class="sourceLine" id="cb6-17" title="17">      <span class="kw">{</span> <span class="ex">error_msg</span> <span class="st">&quot;</span><span class="va">$MSG2</span><span class="st">&quot;</span><span class="kw">;</span> <span class="va">exit_status=$((</span>exit_status + 1<span class="va">))</span>; <span class="kw">}</span></a>
<a class="sourceLine" id="cb6-18" title="18">    <span class="bu">shift</span></a>
<a class="sourceLine" id="cb6-19" title="19">  <span class="kw">done</span></a>
<a class="sourceLine" id="cb6-20" title="20">  <span class="bu">return</span> <span class="st">&quot;</span><span class="va">$exit_status</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb6-21" title="21"><span class="kw">}</span></a></code></pre></div>
<p>To share these functions between the <code>back_me_up</code> and <code>restore_me</code> scripts, we could build a library of functions and source that library. As an example, we could put all the common code in a file called <code>/usr/local/lib/bmulib.sh</code> and add the following code to both scripts to source that file:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" title="1"><span class="va">FUNCLIB=</span>/usr/local/lib/bmulib.sh</a>
<a class="sourceLine" id="cb7-2" title="2"></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="kw">if [[</span> <span class="ot">-r</span> <span class="st">&quot;</span><span class="va">$FUNCLIB</span><span class="st">&quot;</span><span class="kw"> ]]</span>; <span class="kw">then</span></a>
<a class="sourceLine" id="cb7-4" title="4">    <span class="bu">source</span> <span class="st">&quot;</span><span class="va">$FUNCLIB</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="kw">else</span></a>
<a class="sourceLine" id="cb7-6" title="6">    <span class="bu">echo</span> <span class="st">&quot;Cannot read function library!&quot;</span> <span class="op">&gt;&amp;2</span></a>
<a class="sourceLine" id="cb7-7" title="7">    <span class="bu">exit</span> 1</a>
<a class="sourceLine" id="cb7-8" title="8"><span class="kw">fi</span></a></code></pre></div>
<h3 id="general-purpose-libraries">General Purpose Libraries</h3>
<p>Since we hope to become prolific script writers, it makes sense over time, to build a library of common code that our future scripts could potentially use. When undertaking such a project, it’s wise to write high quality functions for the library, as the code may get heavy use. It’s important to test carefully, include a lot of error handling, and fully document the functions. After all, the goal here is to save time writing good scripts, so invest the time up front to save time later.</p>
<h2 id="lets-not-forget-.bashrc">Let’s Not Forget .bashrc</h2>
<p><code>source</code> can be a powerful tool for coordinating the configuration of small sets of machines. For large sets, there are more powerful tools, but <code>source</code> works fine if the job is not too big.</p>
<p>We’ve worked with the <code>.bashrc</code> file before and added things like aliases and a few shell functions. However, when we work with multiple systems (for example, a small network), it might be a good idea to create a common configuration file to align all of the systems. To demonstrate, let’s create a file called <code>.mynetworkrc.sh</code> and place all of the common aliases and shell function we would expect on every machine. To use this file, we would add this one line of code to <code>.bashrc</code>:</p>
<p><code>[[ -r ~/.mynetworkrc.sh ]] &amp;&amp; source ~./.mynetworkrc.sh</code></p>
<p>The advantage of doing it this way is that we won’t have to cut and paste large sections of code every time we configure a new machine or perform an operating system upgrade. We just copy the <code>.mynetwrokrc.sh</code> file to the new machine and add one line to <code>.bashrc</code>.</p>
<p>We can even go further and create a host-specific configuration file that the <code>.mynetworkrc.sh</code> file will source. This would be handy if we need to override something in <code>.mynetworkrc.sh</code> on a particular host. We can do this by creating a configuration file with a file name based on the system’s host name. For example, if our system’s host name is <code>linuxbox1</code> we could create a configuration file named <code>.linuxbox1rc.sh</code> and add this line of code to the <code>.mynetworkrc.sh</code> file:</p>
<p><code>[[ -r ~/.$(hostname)rc.sh ]] &amp;&amp; source ~/.$(hostname)rc.sh</code></p>
<p>By using the <code>hostname</code> command we are able to build a file name that is specific to a particular host.</p>
<p>So, what could we put in our <code>.mynetworkrc.sh</code> file? Here are some ideas:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb8-1" title="1"><span class="co">### Aliases </span><span class="al">###</span></a>
<a class="sourceLine" id="cb8-2" title="2"></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="co"># Reload the .mynetworkrc.sh file. Handy after editing.</span></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="bu">alias</span> reload=<span class="st">&#39;source ~/.mynetworkrc.sh&#39;</span></a>
<a class="sourceLine" id="cb8-5" title="5"></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="co"># Get a root shell</span></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="bu">alias</span> root=<span class="st">&#39;sudo -i&#39;</span></a>
<a class="sourceLine" id="cb8-8" title="8"></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="co"># Print the size of a terminal window in rows and columns</span></a>
<a class="sourceLine" id="cb8-10" title="10"><span class="bu">alias</span> term_size=<span class="st">&#39;echo &quot;Rows=$(tput lines) Cols=$(tput cols)&quot;&#39;</span></a>
<a class="sourceLine" id="cb8-11" title="11"></a>
<a class="sourceLine" id="cb8-12" title="12"><span class="co">### Functions </span><span class="al">###</span></a>
<a class="sourceLine" id="cb8-13" title="13"></a>
<a class="sourceLine" id="cb8-14" title="14"><span class="co"># Check to see if a specified host is alive on the network</span></a>
<a class="sourceLine" id="cb8-15" title="15"></a>
<a class="sourceLine" id="cb8-16" title="16"><span class="fu">ping_host()</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb8-17" title="17"></a>
<a class="sourceLine" id="cb8-18" title="18">  <span class="bu">local</span> <span class="va">target</span></a>
<a class="sourceLine" id="cb8-19" title="19"></a>
<a class="sourceLine" id="cb8-20" title="20">  <span class="kw">if [[</span> <span class="ot">-z</span> <span class="st">&quot;</span><span class="va">$1</span><span class="st">&quot;</span><span class="kw"> ]]</span>; <span class="kw">then</span></a>
<a class="sourceLine" id="cb8-21" title="21">    <span class="bu">echo</span> <span class="st">&quot;Usage: ping_host host&quot;</span> <span class="op">&gt;&amp;2</span></a>
<a class="sourceLine" id="cb8-22" title="22">    <span class="bu">return</span> 1</a>
<a class="sourceLine" id="cb8-23" title="23">  <span class="kw">fi</span></a>
<a class="sourceLine" id="cb8-24" title="24">  <span class="va">target=</span><span class="st">&quot;</span><span class="va">$1</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb8-25" title="25">  <span class="fu">ping</span> -c1 <span class="st">&quot;</span><span class="va">$target</span><span class="st">&quot;</span> <span class="op">&amp;&gt;</span> /dev/null <span class="kw">||</span> <span class="kw">\</span></a>
<a class="sourceLine" id="cb8-26" title="26">    <span class="kw">{</span> <span class="bu">echo</span> <span class="st">&quot;Host &#39;</span><span class="va">$target</span><span class="st">&#39; unreachable.&quot;</span> <span class="op">&gt;&amp;2</span><span class="kw">;</span> <span class="bu">return</span> 1<span class="kw">;</span> <span class="kw">}</span></a>
<a class="sourceLine" id="cb8-27" title="27">  <span class="bu">return</span> 0</a>
<a class="sourceLine" id="cb8-28" title="28"><span class="kw">}</span></a>
<a class="sourceLine" id="cb8-29" title="29"></a>
<a class="sourceLine" id="cb8-30" title="30"><span class="co"># Display a summary of system health</span></a>
<a class="sourceLine" id="cb8-31" title="31"></a>
<a class="sourceLine" id="cb8-32" title="32"><span class="fu">status()</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb8-33" title="33">  <span class="kw">{</span> <span class="co"># Display system uptime</span></a>
<a class="sourceLine" id="cb8-34" title="34">    <span class="bu">echo</span> -e <span class="st">&quot;\nuptime:&quot;</span></a>
<a class="sourceLine" id="cb8-35" title="35">    <span class="fu">uptime</span></a>
<a class="sourceLine" id="cb8-36" title="36"></a>
<a class="sourceLine" id="cb8-37" title="37">    <span class="co"># Display disk resources skipping snap&#39;s pseudo disks </span></a>
<a class="sourceLine" id="cb8-38" title="38">    <span class="bu">echo</span> -e <span class="st">&quot;\ndisk space:&quot;</span></a>
<a class="sourceLine" id="cb8-39" title="39">    <span class="fu">df</span> -h <span class="op">2&gt;</span> /dev/null <span class="kw">|</span> <span class="fu">grep</span> -v snap</a>
<a class="sourceLine" id="cb8-40" title="40">    <span class="bu">echo</span> -e <span class="st">&quot;\ninodes:&quot;</span></a>
<a class="sourceLine" id="cb8-41" title="41">    <span class="fu">df</span> -i <span class="op">2&gt;</span> /dev/null <span class="kw">|</span> <span class="fu">grep</span> -v snap</a>
<a class="sourceLine" id="cb8-42" title="42">    <span class="bu">echo</span> -e <span class="st">&quot;\nblock devices:&quot;</span></a>
<a class="sourceLine" id="cb8-43" title="43">    <span class="ex">/bin/lsblk</span> <span class="kw">|</span> <span class="fu">grep</span> -v snap</a>
<a class="sourceLine" id="cb8-44" title="44"></a>
<a class="sourceLine" id="cb8-45" title="45">    <span class="co"># Display memory resources</span></a>
<a class="sourceLine" id="cb8-46" title="46">    <span class="bu">echo</span> -e <span class="st">&quot;\nmemory:&quot;</span></a>
<a class="sourceLine" id="cb8-47" title="47">    <span class="fu">free</span> -m</a>
<a class="sourceLine" id="cb8-48" title="48"></a>
<a class="sourceLine" id="cb8-49" title="49">    <span class="co"># Display latest log file entries</span></a>
<a class="sourceLine" id="cb8-50" title="50">    <span class="kw">if [[</span> <span class="ot">-r</span> /var/log/syslog<span class="kw"> ]]</span>; <span class="kw">then</span> <span class="co"># Ubuntu</span></a>
<a class="sourceLine" id="cb8-51" title="51">      <span class="bu">echo</span> -e <span class="st">&quot;\nsyslog:&quot;</span></a>
<a class="sourceLine" id="cb8-52" title="52">      <span class="fu">tail</span> /var/log/syslog</a>
<a class="sourceLine" id="cb8-53" title="53">    <span class="kw">fi</span></a>
<a class="sourceLine" id="cb8-54" title="54">    <span class="kw">if [[</span> <span class="ot">-r</span> /var/log/messages<span class="kw"> ]]</span>; <span class="kw">then</span> <span class="co"># Debian, et al.</span></a>
<a class="sourceLine" id="cb8-55" title="55">      <span class="bu">echo</span> -e <span class="st">&quot;\nmessages:&quot;</span></a>
<a class="sourceLine" id="cb8-56" title="56">      <span class="fu">tail</span> /var/log/messages</a>
<a class="sourceLine" id="cb8-57" title="57">    <span class="kw">fi</span></a>
<a class="sourceLine" id="cb8-58" title="58">    <span class="kw">if [[</span> <span class="ot">-r</span> /var/log/journal<span class="kw"> ]]</span>; <span class="kw">then</span> <span class="co"># Arch, others using systemd</span></a>
<a class="sourceLine" id="cb8-59" title="59">      <span class="bu">echo</span> -e <span class="st">&quot;\njournal:&quot;</span></a>
<a class="sourceLine" id="cb8-60" title="60">      <span class="ex">journalctl</span> <span class="kw">|</span> <span class="fu">tail</span></a>
<a class="sourceLine" id="cb8-61" title="61">    <span class="kw">fi</span></a>
<a class="sourceLine" id="cb8-62" title="62">  <span class="kw">}</span> <span class="kw">|</span> <span class="fu">less</span></a>
<a class="sourceLine" id="cb8-63" title="63"><span class="kw">}</span></a>
<a class="sourceLine" id="cb8-64" title="64"></a>
<a class="sourceLine" id="cb8-65" title="65"><span class="co"># Install a package from a distro repository</span></a>
<a class="sourceLine" id="cb8-66" title="66"><span class="co"># Supports Ubuntu, Debian, Fedora, CentOS</span></a>
<a class="sourceLine" id="cb8-67" title="67"></a>
<a class="sourceLine" id="cb8-68" title="68"><span class="fu">install()</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb8-69" title="69">  <span class="kw">if [[</span> <span class="ot">-z</span> <span class="st">&quot;</span><span class="va">$1</span><span class="st">&quot;</span><span class="kw"> ]]</span>; <span class="kw">then</span></a>
<a class="sourceLine" id="cb8-70" title="70">    <span class="bu">echo</span> <span class="st">&quot;Usage: install package...&quot;</span> <span class="op">&gt;&amp;2</span></a>
<a class="sourceLine" id="cb8-71" title="71">    <span class="bu">return</span> 1</a>
<a class="sourceLine" id="cb8-72" title="72">  <span class="kw">elif [[</span> <span class="st">&quot;</span><span class="va">$1</span><span class="st">&quot;</span> <span class="ot">==</span> <span class="st">&quot;-h&quot;</span> || <span class="st">&quot;</span><span class="va">$1</span><span class="st">&quot;</span> <span class="ot">==</span> <span class="st">&quot;--help&quot;</span><span class="kw"> ]]</span>; <span class="kw">then</span></a>
<a class="sourceLine" id="cb8-73" title="73">    <span class="bu">echo</span> <span class="st">&quot;Usage: install package...&quot;</span></a>
<a class="sourceLine" id="cb8-74" title="74">    <span class="bu">return</span></a>
<a class="sourceLine" id="cb8-75" title="75">  <span class="kw">elif [[</span> <span class="ot">-x</span> /usr/bin/apt<span class="kw"> ]]</span>; <span class="kw">then</span></a>
<a class="sourceLine" id="cb8-76" title="76">    <span class="fu">sudo</span> apt update <span class="kw">&amp;&amp;</span> <span class="fu">sudo</span> apt install <span class="st">&quot;</span><span class="va">$@</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb8-77" title="77">    <span class="bu">return</span></a>
<a class="sourceLine" id="cb8-78" title="78">  <span class="kw">elif [[</span> <span class="ot">-x</span> /usr/bin/apt-get<span class="kw"> ]]</span>; <span class="kw">then</span></a>
<a class="sourceLine" id="cb8-79" title="79">    <span class="fu">sudo</span> apt-get update <span class="kw">&amp;&amp;</span> <span class="fu">sudo</span> apt-get install <span class="st">&quot;</span><span class="va">$@</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb8-80" title="80">    <span class="bu">return</span></a>
<a class="sourceLine" id="cb8-81" title="81">  <span class="kw">elif [[</span> <span class="ot">-x</span> /usr/bin/yum<span class="kw"> ]]</span>; <span class="kw">then</span></a>
<a class="sourceLine" id="cb8-82" title="82">    <span class="fu">sudo</span> yum install -y <span class="st">&quot;</span><span class="va">$@</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb8-83" title="83">  <span class="kw">fi</span></a>
<a class="sourceLine" id="cb8-84" title="84"><span class="kw">}</span></a>
<a class="sourceLine" id="cb8-85" title="85"></a>
<a class="sourceLine" id="cb8-86" title="86"><span class="co"># Perform a system update</span></a>
<a class="sourceLine" id="cb8-87" title="87"><span class="co"># Supports Debian, Ubuntu, Fedora, CentOS, Arch</span></a>
<a class="sourceLine" id="cb8-88" title="88"></a>
<a class="sourceLine" id="cb8-89" title="89"><span class="fu">update()</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb8-90" title="90">  <span class="kw">if [[</span> <span class="ot">-x</span> /usr/bin/apt<span class="kw"> ]]</span>; <span class="kw">then</span> <span class="co"># Debian, et al</span></a>
<a class="sourceLine" id="cb8-91" title="91">    <span class="fu">sudo</span> apt update <span class="kw">&amp;&amp;</span> <span class="fu">sudo</span> apt upgrade</a>
<a class="sourceLine" id="cb8-92" title="92">    <span class="bu">return</span></a>
<a class="sourceLine" id="cb8-93" title="93">  <span class="kw">elif [[</span> <span class="ot">-x</span> /usr/bin/apt-get<span class="kw"> ]]</span>; <span class="kw">then</span> <span class="co"># Old Debian, et al</span></a>
<a class="sourceLine" id="cb8-94" title="94">    <span class="fu">sudo</span> apt-get update <span class="kw">&amp;&amp;</span> <span class="fu">sudo</span> apt-get upgrade</a>
<a class="sourceLine" id="cb8-95" title="95">    <span class="bu">return</span></a>
<a class="sourceLine" id="cb8-96" title="96">  <span class="kw">elif [[</span> <span class="ot">-x</span> /usr/bin/yum<span class="kw"> ]]</span>; <span class="kw">then</span> <span class="co"># CentOS/Fedora</span></a>
<a class="sourceLine" id="cb8-97" title="97">    <span class="co"># su -c &quot;yum update&quot;</span></a>
<a class="sourceLine" id="cb8-98" title="98">    <span class="fu">sudo</span> yum update</a>
<a class="sourceLine" id="cb8-99" title="99">    <span class="bu">return</span></a>
<a class="sourceLine" id="cb8-100" title="100">  <span class="kw">elif [[</span> <span class="ot">-x</span> /usr/bin/pacman<span class="kw"> ]]</span>; <span class="kw">then</span> <span class="co"># Arch</span></a>
<a class="sourceLine" id="cb8-101" title="101">    <span class="fu">sudo</span> pacman -Syu</a>
<a class="sourceLine" id="cb8-102" title="102">  <span class="kw">fi</span></a>
<a class="sourceLine" id="cb8-103" title="103"><span class="kw">}</span></a>
<a class="sourceLine" id="cb8-104" title="104"></a>
<a class="sourceLine" id="cb8-105" title="105"><span class="co"># Display distro release info (prints OS name and version)</span></a>
<a class="sourceLine" id="cb8-106" title="106"></a>
<a class="sourceLine" id="cb8-107" title="107"><span class="fu">version()</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb8-108" title="108"></a>
<a class="sourceLine" id="cb8-109" title="109">  <span class="bu">local</span> <span class="va">s</span></a>
<a class="sourceLine" id="cb8-110" title="110"></a>
<a class="sourceLine" id="cb8-111" title="111">  <span class="kw">for</span> <span class="ex">s</span> in os-release \</a>
<a class="sourceLine" id="cb8-112" title="112">           lsb-release \</a>
<a class="sourceLine" id="cb8-113" title="113">           debian_version \</a>
<a class="sourceLine" id="cb8-114" title="114">           centos-release \</a>
<a class="sourceLine" id="cb8-115" title="115">           fedora-release<span class="kw">;</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb8-116" title="116">    [[ <span class="ex">-r</span> <span class="st">&quot;/etc/</span><span class="va">$s</span><span class="st">&quot;</span> ]] <span class="kw">&amp;&amp;</span> <span class="fu">cat</span> <span class="st">&quot;/etc/</span><span class="va">$s</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb8-117" title="117">  <span class="kw">done</span></a>
<a class="sourceLine" id="cb8-118" title="118"><span class="kw">}</span></a></code></pre></div>
<h4 id="ever-wonder-why-its-called-.bashrc">Ever Wonder Why it’s Called .bashrc?</h4>
<p>In our various wanderings around the Linux file system, we have encountered files with names that end with the mysterious suffix “rc” like <code>.bashrc</code>, <code>.vimrc</code>, etc. Heck, many distributions have a bunch of directories in <code>/etc</code> named rc. Why is that? It’s a holdover from ancient Unix. Its original meaning was “run commands,” but it later became “run-control.” A run-control file is generally some kind of script or configuration file that prepares an environment for a program to use. In the case of <code>.bashrc</code> for example, it’s a script that prepares a user’s bash shell environment.</p>
<h2 id="security-considerations-and-other-subtleties">Security Considerations and Other Subtleties</h2>
<p>Even though sourced files are not directly executable, they do contain code that will be executed by anything that sources them. It is important, therefore, that permissions be set to allow writing only by their owners.</p>
<p><code>me@linuxbox:~$ sudo chmod 644 /usr/local/etc/back_me_up.cfg</code></p>
<p>If a sourced file contains confidential information (as a backup program might), set the permissions to 600.</p>
<p>While <code>bash</code>, <code>ksh</code>, and <code>zsh</code> all have the <code>source</code> builtin, <code>dash</code> and all other strictly POSIX compatible shells support only the single dot (.).</p>
<p>If the file name argument given to <code>source</code> does not contain a / character, the directories listed in the <code>PATH</code> variable are searched for the specified file. For security reasons, it’s probably not a good idea to rely on this. Always specify a explicit path name.</p>
<p>Another subtlety has to do with positional parameters. As <code>source</code> executes its commands in the current shell environment, this includes the positional parameters a script was given as well. This is fine in most cases; however, if <code>source</code> is used within a shell function and that shell function has its own positional parameters, <code>source</code> will ignore them and use the shell’s environment instead. To overcome this, positional parameters may be specified after the file name. Consider the following script:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb9-1" title="1"><span class="co">#!/bin/bash</span></a>
<a class="sourceLine" id="cb9-2" title="2"></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="co"># foo_script</span></a>
<a class="sourceLine" id="cb9-4" title="4"></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="bu">source</span> ~/foo.sh</a>
<a class="sourceLine" id="cb9-6" title="6"></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="fu">foo()</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb9-8" title="8">  <span class="bu">source</span> ~/foo.sh</a>
<a class="sourceLine" id="cb9-9" title="9"><span class="kw">}</span></a>
<a class="sourceLine" id="cb9-10" title="10"></a>
<a class="sourceLine" id="cb9-11" title="11"><span class="ex">foo</span> <span class="st">&quot;string2&quot;</span></a></code></pre></div>
<p><code>foo.sh</code> contains this one line of code:</p>
<p><code>echo $1</code></p>
<p>We expect to see the following output:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb10-1" title="1"><span class="ex">me@linuxbox</span>: ~$ foo_script string1</a>
<a class="sourceLine" id="cb10-2" title="2"><span class="ex">string1</span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="ex">string2</span></a></code></pre></div>
<p>But, what we actually get is this:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb11-1" title="1"><span class="ex">me@linuxbox</span>: ~$ foo_script string1</a>
<a class="sourceLine" id="cb11-2" title="2"><span class="ex">string1</span></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="ex">string1</span></a></code></pre></div>
<p>This is because <code>source</code> uses the shell environment the script was given, not the one that exists when the function called. To correct this, we need to write our script this way:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb12-1" title="1"><span class="co">#!/bin/bash</span></a>
<a class="sourceLine" id="cb12-2" title="2"></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="co"># foo_script</span></a>
<a class="sourceLine" id="cb12-4" title="4"></a>
<a class="sourceLine" id="cb12-5" title="5"><span class="bu">source</span> ~/foo.sh</a>
<a class="sourceLine" id="cb12-6" title="6"></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="fu">foo()</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb12-8" title="8">  <span class="bu">source</span> ~/foo.sh <span class="st">&quot;</span><span class="va">$1</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="kw">}</span></a>
<a class="sourceLine" id="cb12-10" title="10"></a>
<a class="sourceLine" id="cb12-11" title="11"><span class="ex">foo</span> <span class="st">&quot;string2&quot;</span></a></code></pre></div>
<p>By adding the desired parameter to the <code>source</code> command within the function <code>foo</code>, we are able to get the desired behavior. Yes, it’s subtle.</p>
<h2 id="summing-up">Summing Up</h2>
<p>By using <code>source</code>, we can greatly reduce the effort needed to maintain our bash scripts particularly when we are deploying them across multiple machines. It also allows us to effectively reuse code with function libraries that all of our scripts can share. Finally, we can use <code>source</code> to build much more capable shell environments for our day to day command line use.</p>
<h2 id="further-reading">Further Reading</h2>
<ul>
<li><p>A Wikipedia article on the dot command from which the <code>source</code> builtin is derived: <a href="https://en.wikipedia.org/wiki/Dot_(command)" class="uri">https://en.wikipedia.org/wiki/Dot_(command)</a></p></li>
<li><p>Another article about run-commands: <a href="https://en.wikipedia.org/wiki/Run_commands" class="uri">https://en.wikipedia.org/wiki/Run_commands</a></p></li>
</ul>


    <div class="pagenav">
      <a
      href="lc3_adv_source.php.html#top">Top</a> | <a
      href="lc3_adv_vimvigor.php.html">Previous</a> | <a
      href="lc3_adventures.php.html#contents">Contents</a> | <a
      href="lc3_adv_standards.php.html">Next</a>
    </div>
<div class="footer">
<hr>
<p class="fineprint">
&copy; 2000-2025,
<a href="mailto:bshotts@users.sourceforge.net">William E. Shotts, Jr.</a>
Verbatim copying and distribution of this entire article is
permitted in any medium, provided this copyright notice is preserved.</p>
<p class="fineprint">Linux&reg; is a registered trademark of Linus Torvalds.</p>
</div><!-- footer -->
</div><!-- main -->
</div><!-- grid-container -->
</body>

</html>